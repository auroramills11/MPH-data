---
title: "Data_Analysis_Fieldwork"
author: "Aurora Mills"
date: "01.02.2023"
output: html_document
---

```{r, eval=FALSE}
install.packages("haven")
install.packages("dplyr")
install.packages("feather")
install.packages("cowplot")
install.packages("survey")
install.packages("car")
```

```{r}
library(dplyr)
library(haven)
library(feather)
library(ggplot2)
library(table1) 
library(survey)
library(car)
```


```{r}
#SMART DATA 
smart<-read_xpt("MMSA2021_XPT.zip")
smart.variables <- dplyr::rename(smart, county= "MMSANAME", 
                                 county.weight= "_MMSAWT", 
                                 education = "_EDUCAG", 
                                 sex = "_SEX", 
                                 income = "_INCOMG1", 
                                 race = "_MRACE1",
                                 age= "_AGE_G", 
                                 smoker.status = "_SMOKER3", 
                                 former.smoker = "_RFSMOK3", 
                                 asthma= "_CASTHM1", 
                                 state= "STATERE1", 
                                 code="DISPCODE") 
#selected variables 
selected.smart<- (dplyr::select(smart.variables, county, county.weight, education, sex, income, race, age, smoker.status, former.smoker, asthma, state, code)) 

#Sex
selected.smart$sex<- car::recode(selected.smart$sex, recodes = "1='0'; 2='1'")

#Income <35, 35-50k, 50-100k, >100k
selected.smart$income<- car::recode(selected.smart$income, recodes= "1:3= '0'; 4= '1'; 5= '2'; 6:7= '3'; 9= '99'")

#Race
selected.smart$race<- car::recode(selected.smart$race, recodes = "1= '0'; 2= '1'; 3= '2'; 4= '3'; 5= '4'; 6= '5'; 7= '6'; 7:9= '99'")

#Age 18-24yr, 25-44yr, 45-64yr, >65
selected.smart$age<- car::recode(selected.smart$age, recodes = "1='0'; 2:3= '1'; 4:5= '2'; 6= '3'")

#Education 
selected.smart$education<- car::recode(selected.smart$education, recodes = "1= '0'; 2= '1'; 3:4= '2'; 9= '99'")

#Smoker Status
selected.smart$smoker.status<- car::recode(selected.smart$smoker.status, recodes= "1:2='2'; 3= '1'; 4= '0'; 9= '99'")

#Asthma Status 
selected.smart$asthma<- car::recode(selected.smart$asthma, recodes = "1= '0'; 2='1'; 9='99'")

selected.smart<- tidyr::drop_na(selected.smart)

```

```{r}
brfss<- read_xpt("LLCP2021XPT.zip")

brfss<- dplyr::rename(brfss, 
                      lungcancer= "CNCRTYP1", 
                      state= "_STATE", 
                      educa= "_EDUCAG", 
                      income= "INCOME3",
                      sex= "SEXVAR", 
                      race= "_RACE",
                      age= "_AGE_G",
                      bmi= "_BMI5CAT", 
                      smoke.status= "_SMOKER3",
                      asthma= "ASTHNOW") 

selected.brfss<- (dplyr::select(brfss, lungcancer, state, educa, income, sex, race, age, bmi, smoke.status, asthma)) 

#Lung Cancer
selected.brfss$lungcancer<- car::recode(selected.brfss$lungcancer, recodes = "1='0'; 2='0'; 3='0'; 4='0'; 5='0'; 5='0'; 6='0'; 7='0'; 8='0'; 9='0'; 10='0'; 11='0'; 12='0'; 13='0'; 14='0'; 15='0'; 16='0'; 17='0'; 18='0'; 19='0'; 20='0'; 21='0'; 22='0'; 23='0'; 24='1'; 25='0'; 26='0'; 27='0'; 28='0'; 29='0'; 30='0'; 77:99='NA'", as.factor = T)
selected.brfss$lungcancer<- relevel(selected.brfss$lungcancer, ref= '0')

#Asthma Status
selected.brfss$asthma<- car::recode(selected.brfss$asthma, recodes = "1='1'; 2='0'; else=NA", as.factor = T)
selected.brfss$asthma<-relevel(selected.brfss$asthma, ref= '0')

#Smoking Status 
selected.brfss$smoke.status<- car::recode(selected.brfss$smoke.status, recodes = "1:2='current smoker'; 3='former smoker'; 4='never smoker'; 9='NA'", as.factor = T)
selected.brfss$smoke.status<- relevel(selected.brfss$smoke.status, ref = 'never smoker')

#Sex
selected.brfss$sex<- car::recode(selected.brfss$sex, recodes= "1='Male'; 2='Female'", as.factor =T)
selected.brfss$sex<- relevel(selected.brfss$sex, ref= 'Male')

#Education: No High School, High School, Some/Higher Education  
selected.brfss$educa<- car::recode(selected.brfss$educa, recodes= "1='NoHighSchool'; 2='HighSchool'; 3:4='Some/HigherEduca'; 9= 'NA'", as.factor=T)
selected.brfss$educa<-relevel(selected.brfss$educa, ref= 'Some/HigherEduca')

#Race
selected.brfss$race<- car::recode(selected.brfss$race, recodes = "1='White'; 2='Black'; 3= 'AmericanIndian/AlaskanNative'; 4='Asian'; 5='NativeHawaiian/PacificIslander'; 6='Other'; 7='Multiracial'; 8='Hispanic'; 9='NA'", as.factor = T)
selected.brfss$race<-relevel(selected.brfss$race, ref= 'White')

#Age 18-34, 35-54, 55-64, >65
selected.brfss$age<- car::recode(selected.brfss$age, recodes= "1:2= '18-34'; 3:4='35-54'; 5='55-64'; 6='>65'", as.factor=T)
selected.brfss$age<-relevel(selected.brfss$age, ref='18-34')

#BMI
selected.brfss$bmi<- car::recode(selected.brfss$bmi, recodes = "1='Underweight'; 2='Normal'; 3='Overweight'; 4='Obese'; else='NA'", as.factor = T)
selected.brfss$bmi<- relevel(selected.brfss$bmi, ref = 'Normal')

#Income <$25k, $25-75k, >$75k
selected.brfss$income<- car::recode(selected.brfss$income, recodes = "1:4='Low'; 5:7='Middle'; 8:11='High'; else='NA'", as.factor = T)
selected.brfss$income<- relevel(selected.brfss$income, ref = 'High')


```


```{r}
table1(~sex + race + age + bmi | lungcancer, data=selected.brfss)

table1(~educa + income | lungcancer, data = selected.brfss)

table1(~smoke.status + asthma | lungcancer, data = selected.brfss)

```

```{r}


```

